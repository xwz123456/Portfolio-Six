<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>投资组合管理系统</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">

  <!-- 配置Tailwind自定义颜色和字体 -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#165DFF',
            secondary: '#36CFC9',
            neutral: '#F5F7FA',
            dark: '#1D2129',
          },
          fontFamily: {
            inter: ['Inter', 'system-ui', 'sans-serif'],
          },
        }
      }
    }
  </script>

  <style type="text/tailwindcss">
    @layer utilities {
      .content-auto {
        content-visibility: auto;
      }
      .sidebar-item {
        @apply flex items-center gap-3 px-4 py-3 text-gray-600 hover:bg-primary/10 hover:text-primary rounded-lg transition-all duration-200 cursor-pointer;
      }
      .sidebar-item.active {
        @apply bg-primary/10 text-primary font-medium;
      }
      .table-cell {
        @apply px-4 py-3 border-b border-gray-100;
      }
      .btn {
        @apply px-4 py-2 rounded-lg font-medium transition-all duration-200;
      }
      .btn-primary {
        @apply bg-primary text-white hover:bg-primary/90;
      }
      .btn-danger {
        @apply bg-red-500 text-white hover:bg-red-600;
      }
      .fade-in {
        animation: fadeIn 0.3s ease-in-out;
      }
      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
      }
    }
  </style>
</head>
<body class="font-inter bg-gray-50 text-dark min-h-screen flex overflow-hidden">
<!-- 侧边栏 -->
<aside class="w-64 bg-white shadow-md z-10 flex-shrink-0">
  <div class="p-5 border-b border-gray-100">
    <h1 class="text-xl font-bold text-primary flex items-center gap-2">
      <i class="fa fa-line-chart"></i>
      <span>投资组合管理</span>
    </h1>
  </div>

  <div class="p-3 mt-4">
    <p class="text-xs uppercase text-gray-400 px-4 mb-2">数据管理</p>
    <div class="sidebar-item active" data-page="items">
      <i class="fa fa-list-alt w-5 text-center"></i>
      <span>Items 表</span>
    </div>
    <div class="sidebar-item" data-page="stocks">
      <i class="fa fa-area-chart w-5 text-center"></i>
      <span>Stocks 表</span>
    </div>
  </div>
</aside>

<!-- 主内容区 -->
<main class="flex-1 overflow-y-auto bg-gray-50">
  <!-- 顶部导航 -->
  <header class="bg-white shadow-sm p-4 sticky top-0 z-10">
    <h2 class="text-lg font-semibold" id="page-title">Items 表管理</h2>
  </header>

  <!-- 页面内容容器 -->
  <div class="p-6">
    <!-- Items表页面 -->
    <div id="items-page" class="bg-white rounded-xl shadow-sm p-6 fade-in">
      <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-6">
        <h3 class="text-lg font-medium">Items 数据列表</h3>
        <div class="relative">
          <input type="text" id="items-search"
                 class="pl-10 pr-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/30 w-full md:w-64"
                 placeholder="搜索...">
          <i class="fa fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
        </div>
      </div>

      <div class="overflow-x-auto">
        <table class="w-full">
          <thead>
          <tr class="bg-gray-50">
            <th class="table-cell text-left font-medium text-gray-500">ID</th>
            <th class="table-cell text-left font-medium text-gray-500">name</th>
            <th class="table-cell text-left font-medium text-gray-500">type</th>
            <th class="table-cell text-left font-medium text-gray-500">value</th>
            <th class="table-cell text-left font-medium text-gray-500">desc</th>
            <th class="table-cell text-left font-medium text-gray-500">createdTime</th>
          </tr>
          </thead>
          <tbody id="items-table-body">
          <!-- Items数据将通过JavaScript动态加载 -->
          <tr>
            <td colspan="5" class="table-cell text-center text-gray-500 py-8">
              <i class="fa fa-spinner fa-spin mr-2"></i>加载中...
            </td>
          </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Stocks表页面 (默认隐藏) -->
    <div id="stocks-page" class="bg-white rounded-xl shadow-sm p-6 fade-in hidden">
      <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-6">
        <h3 class="text-lg font-medium">Stocks 数据列表</h3>
        <div class="relative">
          <input type="text" id="stocks-search"
                 class="pl-10 pr-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/30 w-full md:w-64"
                 placeholder="搜索...">
          <i class="fa fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
        </div>
      </div>

      <div class="overflow-x-auto">
        <table class="w-full">
          <thead>
          <tr class="bg-gray-50">
            <th class="table-cell text-left font-medium text-gray-500">symbol</th>
            <th class="table-cell text-left font-medium text-gray-500">company</th>
            <th class="table-cell text-left font-medium text-gray-500">price</th>
            <th class="table-cell text-left font-medium text-gray-500">change_val</th>
            <th class="table-cell text-left font-medium text-gray-500">percent_change</th>
            <th class="table-cell text-left font-medium text-gray-500">colume</th>
          </tr>
          </thead>
          <tbody id="stocks-table-body">
          <!-- Stocks数据将通过JavaScript动态加载 -->
          <tr>
            <td colspan="7" class="table-cell text-center text-gray-500 py-8">
              <i class="fa fa-spinner fa-spin mr-2"></i>加载中...
            </td>
          </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</main>

<!-- 确认删除模态框 -->
<div id="delete-modal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
  <div class="bg-white rounded-lg w-full max-w-md p-6 shadow-xl">
    <h3 class="text-lg font-semibold mb-2">确认删除</h3>
    <p class="text-gray-600 mb-4">你确定要删除这条记录吗？此操作无法撤销。</p>
    <div class="flex justify-end gap-3">
      <button id="cancel-delete" class="btn border border-gray-200 text-gray-700 hover:bg-gray-50">
        取消
      </button>
      <button id="confirm-delete" class="btn btn-danger">
        确认删除
      </button>
    </div>
  </div>
</div>

<script>
  // 当前页面状态
  let currentPage = 'items';
  let deleteParams = null; // 存储删除参数 { type: 'items'|'stocks', id: ... }

  // 页面加载完成后初始化
  document.addEventListener('DOMContentLoaded', () => {
    // 加载初始数据
    loadItemsData();

    // 侧边栏切换事件
    document.querySelectorAll('.sidebar-item').forEach(item => {
      item.addEventListener('click', () => {
        // 更新活跃状态
        document.querySelectorAll('.sidebar-item').forEach(i => i.classList.remove('active'));
        item.classList.add('active');

        // 切换页面
        currentPage = item.dataset.page;
        switchPage(currentPage);
      });
    });

    // 搜索框事件
    document.getElementById('items-search').addEventListener('input', debounce(searchItems, 300));
    document.getElementById('stocks-search').addEventListener('input', debounce(searchStocks, 300));

    // 模态框事件
    document.getElementById('cancel-delete').addEventListener('click', hideDeleteModal);
    document.getElementById('confirm-delete').addEventListener('click', performDelete);
  });

  // 切换页面
  function switchPage(page) {
    // 更新标题
    document.getElementById('page-title').textContent =
            page === 'items' ? 'Items 表管理' : 'Stocks 表管理';

    // 显示/隐藏页面
    document.getElementById('items-page').classList.toggle('hidden', page !== 'items');
    document.getElementById('stocks-page').classList.toggle('hidden', page !== 'stocks');

    // 加载对应页面数据
    if (page === 'items') {
      loadItemsData();
    } else {
      loadStocksData();
    }
  }

  // 加载Items表数据
  async function loadItemsData(search = '') {
    try {
      // 实际项目中替换为你的API地址
      let url = 'http://localhost:3000/items/items';
      if (search) {
        url += `?search=${encodeURIComponent(search)}`;
      }

      const response = await fetch(url);
      const result = await response.json();

      const tableBody = document.getElementById('items-table-body');

      if (result.success && result.data.length > 0) {
        // 渲染数据
        tableBody.innerHTML = result.data.map(item => `
                        <tr class="hover:bg-gray-50 transition-colors">
                            <td class="table-cell">${item.id}</td>
                            <td class="table-cell">${item.name}</td>
                            <td class="table-cell">${item.type}</td>
                            <td class="table-cell">${item.value}</td>
                            <td class="table-cell">${item.description || '-'}</td>
                            <td class="table-cell">${item.created_at}</td>
                            <td class="table-cell">
                                <button class="text-red-500 hover:text-red-700 transition-colors"
                                    onclick="showDeleteModal('items', ${item.id})">
                                    <i class="fa fa-trash-o"></i> 删除
                                </button>
                            </td>
                        </tr>
                    `).join('');
      } else {
        // 无数据状态
        tableBody.innerHTML = `
                        <tr>
                            <td colspan="5" class="table-cell text-center text-gray-500 py-8">
                                <i class="fa fa-inbox mr-2"></i>${search ? '未找到匹配数据' : '暂无数据'}
                            </td>
                        </tr>
                    `;
      }
    } catch (error) {
      console.error('加载Items数据失败:', error);
      document.getElementById('items-table-body').innerHTML = `
                    <tr>
                        <td colspan="5" class="table-cell text-center text-red-500 py-8">
                            <i class="fa fa-exclamation-circle mr-2"></i>加载失败，请重试
                        </td>
                    </tr>
                `;
    }
  }

  // 加载Stocks表数据
  async function loadStocksData(search = '') {
    try {
      // 实际项目中替换为你的API地址
      let url = 'http://localhost:3000/stocks/stock';
      if (search) {
        url += `?search=${encodeURIComponent(search)}`;
      }

      const response = await fetch(url);
      const result = await response.json();

      const tableBody = document.getElementById('stocks-table-body');

      if (result.success && result.data.length > 0) {
        // 渲染数据
        tableBody.innerHTML = result.data.map(stock => `
                        <tr class="hover:bg-gray-50 transition-colors">
                            <td class="table-cell font-medium">${stock.symbol}</td>
                            <td class="table-cell">${stock.company_name}</td>
                            <td class="table-cell">$${stock.price}</td>
                            <td class="table-cell ${stock.change_val >= 0 ? 'text-green-500' : 'text-red-500'}">
                                ${stock.change_val >= 0 ? '+' : ''}${stock.change_val}
                            </td>
                            <td class="table-cell ${stock.percent_change >= 0 ? 'text-green-500' : 'text-red-500'}">
                                ${stock.percent_change >= 0 ? '+' : ''}${stock.percent_change}%
                            </td>
                            <td class="table-cell">${stock.volume}</td>
                            <td class="table-cell">
                                <button class="text-red-500 hover:text-red-700 transition-colors"
                                    onclick="showDeleteModal('stocks', '${stock.symbol}')">
                                    <i class="fa fa-trash-o"></i> 删除
                                </button>
                            </td>
                        </tr>
                    `).join('');
      } else {
        // 无数据状态
        tableBody.innerHTML = `
                        <tr>
                            <td colspan="7" class="table-cell text-center text-gray-500 py-8">
                                <i class="fa fa-inbox mr-2"></i>${search ? '未找到匹配数据' : '暂无数据'}
                            </td>
                        </tr>
                    `;
      }
    } catch (error) {
      console.error('加载Stocks数据失败:', error);
      document.getElementById('stocks-table-body').innerHTML = `
                    <tr>
                        <td colspan="7" class="table-cell text-center text-red-500 py-8">
                            <i class="fa fa-exclamation-circle mr-2"></i>加载失败，请重试
                        </td>
                    </tr>
                `;
    }
  }

  // 搜索Items
  function searchItems() {
    const searchTerm = document.getElementById('items-search').value.trim();
    loadItemsData(searchTerm);
  }

  // 搜索Stocks
  function searchStocks() {
    const searchTerm = document.getElementById('stocks-search').value.trim();
    loadStocksData(searchTerm);
  }

  // 显示删除确认框
  function showDeleteModal(type, id) {
    deleteParams = { type, id };
    document.getElementById('delete-modal').classList.remove('hidden');
  }

  // 隐藏删除确认框
  function hideDeleteModal() {
    deleteParams = null;
    document.getElementById('delete-modal').classList.add('hidden');
  }

  // 执行删除操作
  async function performDelete() {
    if (!deleteParams) return;

    const { type, id } = deleteParams;
    let apiUrl = '';

    // 根据类型拼接不同的API路径
    if (type === 'items') {
      // items 的删除路径：/items/:id （假设后端路由是 app.use('/items', ...) + router.delete('/:id', ...)）
      apiUrl = `http://localhost:3000/items/items/${id}`;
    } else if (type === 'stocks') {
      // stocks 的删除路径：/stocks/:symbol （假设后端路由是 app.use('/stocks', ...) + router.delete('/:symbol', ...)）
      apiUrl = `http://localhost:3000/stocks/stock/${id}`;
    } else {
      alert('无效的操作类型');
      return;
    }



    try {
      // 实际项目中替换为你的API地址
      const response = await fetch(apiUrl, {
        method: 'DELETE',
        headers: {
          'Content-Type': 'application/json'
        }
      });

      const result = await response.json();

      if (response.ok && result.success) {
        // 删除成功，重新加载数据
        if (type === 'items') {
          loadItemsData(document.getElementById('items-search').value.trim());
        } else {
          loadStocksData(document.getElementById('stocks-search').value.trim());
        }
        hideDeleteModal();

        // 显示成功提示（实际项目中可以使用toast组件）
        alert('删除成功');
      } else {
        throw new Error(result.message || '删除失败');
      }
    } catch (error) {
      console.error('删除失败:', error);
      alert(`删除失败: ${error.message}`);
    }
  }

  // 防抖函数 - 优化搜索性能
  function debounce(func, delay) {
    let timeoutId;
    return function(...args) {
      clearTimeout(timeoutId);
      timeoutId = setTimeout(() => func.apply(this, args), delay);
    };
  }

  // 暴露函数到全局，供HTML中onclick调用
  window.showDeleteModal = showDeleteModal;
</script>
</body>
</html>
